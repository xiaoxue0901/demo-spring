#事务支持

## 事务介绍
> 事务:指的是逻辑上一组操作,组成这个事务的各个执行单元, 要么一起成功,要么一起失败.

事务的特性(ACID):
* 原子性(Atomicity): 事务包含的所有操作要么全部成功, 要么全部失败
* 一致性(Consistency): 指事务必须使数据库从一个一致性状态变换到另一个一致性状态,也就是说一个事务执行之前和执行之后必须处于一个一致性状态.
* 隔离性(Isolation): 当多个用户并发访问数据库时,数据库为每一个用户开启的事务, 不能被其他事务的操作所干扰, 多个事务之间要相互隔离
* 持久性(Durability): 指一个事务一旦提交了, 那么对数据库中的数据的改变就是永久性的, 即使在数据库系统遇到故障的情况下也不会丢失事务的操作
  
##事务并发问题(隔离性导致)
在事务的并发操作中可能会出现一些问题
- 脏读: 一个事务读取到另一个事务未提交的数据.
- 不可重复读: 一个事务因读取到另一个事务已提交的数据, 导致对同一条记录读取两次以上的结果不一致. update操作
- 幻读: 一个事务因读取到另一个事务已提交的数据, 导致对同一张表读取两次以上的结果不一致. insert, delete操作.

##事务隔离级别

为了避免上面出现的情况, 在标准的SQL规范中, 定义了4个事务隔离级别.
* 四种隔离级别(mysql的由低到高的隔离级别)
  > 1. Read uncommited(读取未提交): 最低级别, 任何情况都无法保证
  > 2. read commited(读已提交): 可避免脏读的发生
  > 3. repeatable read(可重复读): 可避免脏读, 不可重复读的发生
  > 4. serializable(串行化): 可避免脏读,不可重复读,幻读的发生.
* 默认隔离级别
 > 大多数数据库默认隔离级别是read commited(RC)
> MYSQL数据库的默认隔离级别是Repeatable read(RR)
* 注意事项
`隔离级别越高, 越能保证数据的完整性和一致性, 但是对并发性能的影响也越大`

## Spring框架事务管理相关接口  
> Spring并不直接管理事务, 而是提供了事务管理接口是PlatformTransactionManager, 通过这个接口, Spring为各个平台都提供了对应的事务管理器.具体的实现是各个平台自己的事情了
> PlatformTransactionManager接口: 平台事务管理器(真正管理事务的类),根据不同的持久层框架,需要选择不同的实现类
> TransactionDefinition接口: 事务定义的信息(事务的隔离级别, 传播行为, 超时, 只读)
> TransactionStatus接口: 事务的状态(是否新事务,是否已提交, 是否有保存点, 是否回滚)
> 总结:上述对象之间的关系:平台事务管理器真正管理事务对象. 根据事务定义信息. 

## Spring框架事务管理的分类
1. Spring的编程式事务管理(不关注)
`通过手动编写代码的方式完成事务的管理`
2. Spring的声明式事务管理(底层采用AOP的技术)   
`通过一段配置的方式完成事务的管理`
   声明式事务管理又分为三种方式
   * 基于AspectJ的XML方式
   * 基于AspectJ的注解和XML混用的方式
   * 基于AspectJ的纯注解方式

### @Transactional注解
> 类上加@Transactional: 表示该类中所有的方法被事务管理
> 方法上加上@Transactional: 表示只有该方法被事务管理

### @EnableTransactionManagement
> 左右: 开启事务注解